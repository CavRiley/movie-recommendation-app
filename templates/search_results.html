{% extends "base.html" %}

{% block title %}Search Results | Polyglot Movie Recs{% endblock %}

{% block content %}
<section class="hero">
    <h2>Search Results</h2>
    <p>Results for: <strong>{{ search_term }}</strong></p>
    <a href="{{ url_for('dashboard') }}" style="color: #38bdf8; text-decoration: none;">← Back to Dashboard</a>
</section>

<!-- Search Bar -->
<section class="movie-section">
    <form action="{{ url_for('search') }}" method="GET">
        <div class="search_bar" style="display: flex; gap: 0.5rem; align-items: center; flex-wrap: wrap;">
            <label for="term" style="min-width: 100px;">Search Movies: </label>
            <input class="input" id="term" name="term" type="text"
                value="{{ search_term }}"
                placeholder="Star Wars, Indiana Jones..."
                style="padding: 0.5rem; flex: 1; min-width: 200px;">
            <button class="btn" type="submit" style="cursor: pointer; padding: 0.5rem 1rem; font-size: inherit;">Search</button>
            <a href="{{ url_for('random_movie') }}" class="btn" style="cursor: pointer; padding: 0.5rem 1rem; text-decoration: none; display: inline-block; background: #3B666B; color: #e5e7eb; border: none; border-radius: 0.5rem; font-size: inherit;">
                Random Movie
            </a>
        </div>
        <div style="margin-top: 1rem; display: flex; gap: 1rem; align-items: center; flex-wrap: wrap;">
            <div style="display: flex; gap: 0.5rem; align-items: center;">
                <label for="limit" style="font-size: 0.875rem;">Results: </label>
                <select name="limit" id="limit" style="padding: 0.5rem; background: #0f172a; border: 1px solid #1f2937; color: #e5e7eb; border-radius: 0.5rem;">
                    <option value="10" {% if limit == 10 %}selected{% endif %}>10</option>
                    <option value="25" {% if limit == 25 %}selected{% endif %}>25</option>
                    <option value="50" {% if limit == 50 %}selected{% endif %}>50</option>
                    <option value="100" {% if limit == 100 %}selected{% endif %}>100</option>
                </select>
            </div>
            <div style="display: flex; gap: 0.5rem; align-items: center;">
                <label for="sort_by" style="font-size: 0.875rem;">Sort by: </label>
                <select name="sort_by" id="sort_by" style="padding: 0.5rem; background: #0f172a; border: 1px solid #1f2937; color: #e5e7eb; border-radius: 0.5rem;">
                    <option value="relevance" {% if sort_by == 'relevance' %}selected{% endif %}>Relevance</option>
                    <option value="rating_high" {% if sort_by == 'rating_high' %}selected{% endif %}>Rating (High to Low)</option>
                    <option value="rating_low" {% if sort_by == 'rating_low' %}selected{% endif %}>Rating (Low to High)</option>
                    <option value="title_asc" {% if sort_by == 'title_asc' %}selected{% endif %}>Title (A-Z)</option>
                    <option value="title_desc" {% if sort_by == 'title_desc' %}selected{% endif %}>Title (Z-A)</option>
                    <option value="year_desc" {% if sort_by == 'year_desc' %}selected{% endif %}>Year (Newest First)</option>
                    <option value="year_asc" {% if sort_by == 'year_asc' %}selected{% endif %}>Year (Oldest First)</option>
                </select>
            </div>
        </div>
    </form>
</section>

<!-- Search Results -->
<section class="movie-section">
    <h3>Found {{ movies|length }} movie(s)</h3>
    
    {% if movies %}
        <div class="movie-grid">
            {% for movie in movies %}
                <article class="movie-card">
                    <h4 class="movie-title">{{ movie.title }}</h4>
                    {% if movie.genres %}
                        <p class="movie-genres">{{ movie.genres }}</p>
                    {% endif %}
                    <p class="movie-rating">
                        Avg Rating: ⭐ {{ "%.1f"|format(movie.avg_rating) }} / 5
                        {% if movie.year %}
                            | Year: {{ movie.year }}
                        {% endif %}
                    </p>
                    
                    {% if movie.has_seen %}
                        <div style="margin-top: 0.75rem; padding: 0.5rem; background: #065f46; border-radius: 0.5rem;">
                            <p style="margin: 0; font-size: 0.875rem;">
                                ✓ You've seen this
                            </p>
                            <p style="margin: 0.25rem 0 0 0; font-weight: 600;">
                                Your Rating: ⭐ {{ "%.1f"|format(movie.user_rating) }}
                            </p>
                        </div>
                    {% else %}
                        <!-- Rating Form -->
                        <form method="POST" action="{{ url_for('rate_movie', movie_id=movie.id) }}" style="margin-top: 1rem;">
                            <div style="display: flex; gap: 0.5rem; align-items: center;">
                                <select name="rating" style="flex: 1; padding: 0.5rem; background: #0f172a; border: 1px solid #1f2937; color: #e5e7eb; border-radius: 0.5rem;">
                                    <option value="5">⭐⭐⭐⭐⭐ (5)</option>
                                    <option value="4.5">⭐⭐⭐⭐✨ (4.5)</option>
                                    <option value="4">⭐⭐⭐⭐ (4)</option>
                                    <option value="3.5">⭐⭐⭐✨ (3.5)</option>
                                    <option value="3">⭐⭐⭐ (3)</option>
                                    <option value="2.5">⭐⭐✨ (2.5)</option>
                                    <option value="2">⭐⭐ (2)</option>
                                    <option value="1.5">⭐✨ (1.5)</option>
                                    <option value="1">⭐ (1)</option>
                                    <option value="0.5">✨ (0.5)</option>
                                </select>
                                <button type="submit" style="padding: 0.5rem 1rem; background: #3B666B; border: none; color: #e5e7eb; border-radius: 0.5rem; cursor: pointer;">
                                    Rate
                                </button>
                            </div>
                        </form>
                    {% endif %}
                </article>
            {% endfor %}
        </div>
    {% else %}
        <p style="color: #9ca3af;">No movies found matching "{{ search_term }}". Try a different search term.</p>
    {% endif %}
</section>
{% endblock %}